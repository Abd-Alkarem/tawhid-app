import React, { useState, useEffect } from 'react';
import { BookOpen, Search, X, ChevronRight, Loader2 } from 'lucide-react';
import './Books.css';
import { booksContent } from '../data/islamicBooksContent';

function Books({ onClose }) {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [selectedBook, setSelectedBook] = useState(null);
  const [bookContent, setBookContent] = useState('');
  const [loading, setLoading] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [books, setBooks] = useState([]);
  const [loadingBooks, setLoadingBooks] = useState(true);

  // Popular Islamic books categories
  const categories = [
    { id: 'all', name: 'ุงููู', nameEn: 'All' },
    { id: 'aqeedah', name: 'ุงูุนููุฏุฉ', nameEn: 'Creed' },
    { id: 'fiqh', name: 'ุงูููู', nameEn: 'Jurisprudence' },
    { id: 'hadith', name: 'ุงูุญุฏูุซ', nameEn: 'Hadith' },
    { id: 'tafsir', name: 'ุงูุชูุณูุฑ', nameEn: 'Tafsir' },
    { id: 'seerah', name: 'ุงูุณูุฑุฉ', nameEn: 'Biography' },
    { id: 'adab', name: 'ุงูุขุฏุงุจ', nameEn: 'Manners' }
  ];

  // Fetch books from Hugging Face Shamela API
  useEffect(() => {
    // Use curated Islamic books with actual content
    const curatedBooks = [
      {
        id: 'quran',
        title: 'ุงููุฑุขู ุงููุฑูู',
        author: 'ููุงู ุงููู',
        category: 'quran',
        hasContent: true
      },
      {
        id: 'sahih-bukhari',
        title: 'ุตุญูุญ ุงูุจุฎุงุฑู',
        author: 'ุงูุฅูุงู ุงูุจุฎุงุฑู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'sahih-muslim',
        title: 'ุตุญูุญ ูุณูู',
        author: 'ุงูุฅูุงู ูุณูู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'sunan-abu-dawud',
        title: 'ุณูู ุฃุจู ุฏุงูุฏ',
        author: 'ุฃุจู ุฏุงูุฏ',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'jami-tirmidhi',
        title: 'ุฌุงูุน ุงูุชุฑูุฐู',
        author: 'ุงูุฅูุงู ุงูุชุฑูุฐู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'sunan-nasai',
        title: 'ุณูู ุงููุณุงุฆู',
        author: 'ุงูุฅูุงู ุงููุณุงุฆู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'sunan-ibn-majah',
        title: 'ุณูู ุงุจู ูุงุฌู',
        author: 'ุงุจู ูุงุฌู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'muwatta-malik',
        title: 'ููุทุฃ ูุงูู',
        author: 'ุงูุฅูุงู ูุงูู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'musnad-ahmad',
        title: 'ูุณูุฏ ุฃุญูุฏ',
        author: 'ุงูุฅูุงู ุฃุญูุฏ',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'sunan-darimi',
        title: 'ุณูู ุงูุฏุงุฑูู',
        author: 'ุงูุฅูุงู ุงูุฏุงุฑูู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: '40-hadith-nawawi',
        title: 'ุงูุฃุฑุจุนูู ุงูููููุฉ',
        author: 'ุงูุฅูุงู ุงููููู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'riyadh-salihin',
        title: 'ุฑูุงุถ ุงูุตุงูุญูู',
        author: 'ุงูุฅูุงู ุงููููู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'adab-mufrad',
        title: 'ุงูุฃุฏุจ ุงูููุฑุฏ',
        author: 'ุงูุฅูุงู ุงูุจุฎุงุฑู',
        category: 'adab',
        hasContent: true
      },
      {
        id: 'shamail-muhammadiyah',
        title: 'ุงูุดูุงุฆู ุงููุญูุฏูุฉ',
        author: 'ุงูุฅูุงู ุงูุชุฑูุฐู',
        category: 'seerah',
        hasContent: true
      },
      {
        id: 'mishkat-masabih',
        title: 'ูุดูุงุฉ ุงููุตุงุจูุญ',
        author: 'ุงูุฎุทูุจ ุงูุชุจุฑูุฒู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'bulugh-maram',
        title: 'ุจููุบ ุงููุฑุงู',
        author: 'ุงุจู ุญุฌุฑ ุงูุนุณููุงูู',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'forty-collections',
        title: 'ุงูุฃุฑุจุนููุงุช',
        author: 'ูุฌููุนุฉ',
        category: 'hadith',
        hasContent: true
      },
      {
        id: 'hisn-muslim',
        title: 'ุญุตู ุงููุณูู',
        author: 'ุณุนูุฏ ุจู ููู ุงููุญุทุงูู',
        category: 'adab',
        hasContent: true
      },
      {
        id: 'tafsir-tabari',
        title: 'ุชูุณูุฑ ุงูุทุจุฑู',
        author: 'ุงูุฅูุงู ุงูุทุจุฑู',
        category: 'tafsir',
        hasContent: true
      },
      {
        id: 'tafsir-kathir',
        title: 'ุชูุณูุฑ ุงุจู ูุซูุฑ',
        author: 'ุงุจู ูุซูุฑ',
        category: 'tafsir',
        hasContent: true
      }
    ];
    
    setBooks(curatedBooks);
    setLoadingBooks(false);
  }, []);
  
  const getCategoryFromIndex = (index) => {
    const categoryList = ['aqeedah', 'fiqh', 'hadith', 'tafsir', 'seerah', 'adab'];
    return categoryList[index % categoryList.length];
  };

  const filteredBooks = books.filter(book => {
    const matchesCategory = selectedCategory === 'all' || book.category === selectedCategory;
    const matchesSearch = book.title.includes(searchTerm) || 
                         book.titleEn.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         book.author.includes(searchTerm);
    return matchesCategory && matchesSearch;
  });

  // Function to get book pages
  const getBookPages = (bookId) => {
    const bookPages = {
      4: [ // Tafsir Ibn Kathir - 10 pages
        `<h3>ููุฏูุฉ ุงูุชูุณูุฑ - ุงูุตูุญุฉ 1</h3>
         <p>ุงูุญูุฏ ููู ุฑุจ ุงูุนุงููููุ ูุงูุตูุงุฉ ูุงูุณูุงู ุนูู ุณูุฏูุง ูุญูุฏ ูุนูู ุขูู ูุตุญุจู ุฃุฌูุนูู.</p>
         <p>ูุฐุง ุชูุณูุฑ ุงููุฑุขู ุงูุนุธูู ููุฅูุงู ุงุจู ูุซูุฑุ ููู ูู ุฃุดูุฑ ูุชุจ ุงูุชูุณูุฑ ูุฃูุซููุง.</p>
         <h3>ูููุฌ ุงููุชุงุจ</h3>
         <p>ูุนุชูุฏ ุงูุฅูุงู ุงุจู ูุซูุฑ ูู ุชูุณูุฑู ุนูู:</p>
         <ul>
           <li>ุชูุณูุฑ ุงููุฑุขู ุจุงููุฑุขู</li>
           <li>ุชูุณูุฑ ุงููุฑุขู ุจุงูุณูุฉ ุงููุจููุฉ</li>
           <li>ุชูุณูุฑ ุงููุฑุขู ุจุฃููุงู ุงูุตุญุงุจุฉ</li>
           <li>ุชูุณูุฑ ุงููุฑุขู ุจุฃููุงู ุงูุชุงุจุนูู</li>
         </ul>`,
        `<h3>ุชูุณูุฑ ุณูุฑุฉ ุงููุงุชุญุฉ - ุงูุตูุญุฉ 2</h3>
         <p><strong>ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ุงูุจุณููุฉ ุขูุฉ ูู ุงููุงุชุญุฉุ ููู ุฃูู ุขูุฉ ูููุง ุนูู ุงูุตุญูุญ.</p>
         <p>ููููู ุชุนุงูู: {ุจูุณููู ุงูููููู} ุฃู: ุฃุจุชุฏุฆ ุจูู ุงุณู ููู ุชุนุงููุ ูุฃู ููุธ ุงุณู ููุฑุฏ ูุถุงูุ ููุนู ุฌููุน ุงูุฃุณูุงุก ุงูุญุณูู.</p>
         <p><strong>ุงูุฑููุญููููฐูู ุงูุฑููุญูููู:</strong> ุงุณูุงู ูุดุชูุงู ูู ุงูุฑุญูุฉุ ูุงูุฑุญูู ุฃุดุฏ ูุจุงูุบุฉ ูู ุงูุฑุญูู.</p>`,
        `<h3>ุชูุณูุฑ ุงูุญูุฏ ููู - ุงูุตูุญุฉ 3</h3>
         <p><strong>ุงููุญูููุฏู ููููููู ุฑูุจูู ุงููุนูุงููููููู</strong></p>
         <p>ูุงู ุงุจู ุนุจุงุณ ุฑุถู ุงููู ุนูููุง: ุงูุญูุฏ ููู ูู ุงูุดูุฑ ูููุ ูุงูุงุณุชุฎุฐุงุก ููุ ูุงูุฅูุฑุงุฑ ูู ุจูุนูู ูุขูุงุฆู.</p>
         <p>ููููู: {ุฑูุจูู ุงููุนูุงููููููู} ุงูุฑุจ ูู ุงููุงูู ุงููุชุตุฑูุ ูุงูุนุงูููู ุฌูุน ุนุงูููุ ููู ูู ูุง ุณูู ุงููู ุชุนุงูู.</p>`,
        `<h3>ุงูุฑุญูู ุงูุฑุญูู - ุงูุตูุญุฉ 4</h3>
         <p><strong>ุงูุฑููุญููููฐูู ุงูุฑููุญูููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ูุฐุงู ุงูุงุณูุงู ุงููุฑููุงู ูู ุฃุณูุงุก ุงููู ุงูุญุณููุ ูููุง ูุดุชูุงู ูู ุงูุฑุญูุฉ.</p>
         <p>ูุงูุฑุญูู ุฃุดุฏ ูุจุงูุบุฉ ูู ุงูุฑุญููุ ูุฃู ุจูุงุก ูุนูุงู ุฃุดุฏ ูุจุงูุบุฉ ูู ูุนูู.</p>
         <p>ูููู: ุงูุฑุญูู ุงูุฐู ูุณุนุช ุฑุญูุชู ูู ุดูุกุ ูุงูุฑุญูู ุจุงููุคูููู ุฎุงุตุฉ.</p>`,
        `<h3>ูุงูู ููู ุงูุฏูู - ุงูุตูุญุฉ 5</h3>
         <p><strong>ููุงูููู ูููููู ุงูุฏููููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ููู ุงูุฏูู ูู ููู ุงูุญุณุงุจ ูุงูุฌุฒุงุกุ ููู ููู ุงูููุงูุฉ.</p>
         <p>ูุงููู ุชุนุงูู ูู ุงููุงูู ุงููุชุตุฑู ูู ุฐูู ุงููููุ ูุง ูููู ุฃุญุฏ ูุนู ุดูุฆุงู.</p>
         <p>ูุงู ุชุนุงูู: {ูููููู ุงูููููููู ุงูููููููู ููููููู ุงููููุงุญูุฏู ุงูููููููุงุฑู}</p>`,
        `<h3>ุฅูุงู ูุนุจุฏ - ุงูุตูุญุฉ 6</h3>
         <p><strong>ุฅููููุงูู ููุนูุจูุฏู ููุฅููููุงูู ููุณูุชูุนูููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ูุฐุง ุฃูู ูุง ูุทูุจู ุงูุนุจุฏ ูู ุฑุจูุ ููู ุฅุฎูุงุต ุงูุนุจุงุฏุฉ ููู ูุญุฏู.</p>
         <p>ูุชูุฏูู ุงูููุนูู ูููุฏ ุงูุญุตุฑ ูุงูุงุฎุชุตุงุตุ ุฃู: ูุฎุตู ุจุงูุนุจุงุฏุฉ ูุงูุงุณุชุนุงูุฉ.</p>
         <p>ูุงูุนุจุงุฏุฉ: ุงุณู ุฌุงูุน ููู ูุง ูุญุจู ุงููู ููุฑุถุงู ูู ุงูุฃููุงู ูุงูุฃุนูุงู ุงูุจุงุทูุฉ ูุงูุธุงูุฑุฉ.</p>`,
        `<h3>ุงูุฏูุง ุงูุตุฑุงุท ุงููุณุชููู - ุงูุตูุญุฉ 7</h3>
         <p><strong>ุงููุฏูููุง ุงูุตููุฑูุงุทู ุงููููุณูุชูููููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ุงููุฏุงูุฉ ูู ุงูุฅุฑุดุงุฏ ูุงูุชููููุ ูุงูุตุฑุงุท ุงููุณุชููู ูู ุงูุทุฑูู ุงููุงุถุญ ุงูุฐู ูุง ุงุนูุฌุงุฌ ููู.</p>
         <p>ููู ุงูุฅุณูุงูุ ุฃู ุงููุฑุขูุ ุฃู ุงูุณูุฉุ ุฃู ุทุฑูู ุงูุญู.</p>
         <p>ููู ูุฐู ุงูุฃููุงู ุตุญูุญุฉุ ูุฅู ุงูุฅุณูุงู ูู ุงุชุจุงุน ุงููุฑุขู ูุงูุณูุฉ.</p>`,
        `<h3>ุตุฑุงุท ุงูุฐูู ุฃูุนูุช ุนูููู - ุงูุตูุญุฉ 8</h3>
         <p><strong>ุตูุฑูุงุทู ุงูููุฐูููู ุฃูููุนูููุชู ุนููููููููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ูู ุงูุฐูู ุฃูุนู ุงููู ุนูููู ูู ุงููุจููู ูุงูุตุฏูููู ูุงูุดูุฏุงุก ูุงูุตุงูุญูู.</p>
         <p>ูุงู ุชุนุงูู: {ูููููู ููุทูุนู ุงูููููู ููุงูุฑููุณูููู ููุฃููููุฆููู ููุนู ุงูููุฐูููู ุฃูููุนููู ุงูููููู ุนููููููููู}</p>`,
        `<h3>ุบูุฑ ุงููุบุถูุจ ุนูููู - ุงูุตูุญุฉ 9</h3>
         <p><strong>ุบูููุฑู ุงููููุบูุถููุจู ุนููููููููู ููููุง ุงูุถููุงูููููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ุงููุบุถูุจ ุนูููู ูู ุงููููุฏุ ูุงูุถุงููู ูู ุงููุตุงุฑู.</p>
         <p>ูุงููููุฏ ุนุฑููุง ุงูุญู ููู ูุนูููุง ุจูุ ูุงููุตุงุฑู ุนูููุง ุจุบูุฑ ุนูู.</p>
         <p>ูููุฐุง ูุงู ุบุถุจ ุงููู ุนูู ุงููููุฏ ุฃุดุฏุ ูุงูุถูุงู ูู ุงููุตุงุฑู ุฃุธูุฑ.</p>`,
        `<h3>ุขููู - ุงูุตูุญุฉ 10</h3>
         <p><strong>ุขููู</strong></p>
         <p>ูุงู ุงุจู ูุซูุฑ: ุขููู ูุนูุงูุง: ุงูููู ุงุณุชุฌุจุ ุฃู ุงูููู ุงูุนู.</p>
         <p>ููู ููุณุช ูู ุงููุงุชุญุฉุ ูููู ูุณุชุญุจ ููููุง ุจุนุฏ ุงููุงุชุญุฉ ูู ุงูุตูุงุฉ ูุบูุฑูุง.</p>
         <p>ููุฏ ุซุจุช ูู ุงูุตุญูุญูู ุฃู ุงููุจู ุตูู ุงููู ุนููู ูุณูู ูุงู: "ุฅุฐุง ุฃููู ุงูุฅูุงู ูุฃููููุงุ ูุฅูู ูู ูุงูู ุชุฃูููู ุชุฃููู ุงูููุงุฆูุฉ ุบูุฑ ูู ูุง ุชูุฏู ูู ุฐูุจู"</p>`
      ],
      6: [ // Al-Aqeedah al-Wasitiyyah - 12 pages
        `<h3>ุงูููุฏูุฉ - ุงูุตูุญุฉ 1</h3>
         <p>ุจุณู ุงููู ุงูุฑุญูู ุงูุฑุญูู</p>
         <p>ุงูุญูุฏ ููู ุงูุฐู ุฃุฑุณู ุฑุณููู ุจุงููุฏู ูุฏูู ุงูุญู ููุธูุฑู ุนูู ุงูุฏูู ููู ูููู ุจุงููู ุดููุฏุงู.</p>
         <h3>ุนููุฏุฉ ุฃูู ุงูุณูุฉ ูุงูุฌูุงุนุฉ</h3>
         <p>ููู ุงูุฅููุงู ุจุงููู: ุงูุฅููุงู ุจูุง ูุตู ุจู ููุณู ูู ูุชุงุจูุ ูุจูุง ูุตูู ุจู ุฑุณููู ูุญูุฏ ุตูู ุงููู ุนููู ูุณููุ ูู ุบูุฑ ุชุญุฑูู ููุง ุชุนุทููุ ููู ุบูุฑ ุชูููู ููุง ุชูุซูู.</p>`,
        `<h3>ุงูุฅููุงู ุจุงููู - ุงูุตูุญุฉ 2</h3>
         <p>ุจู ูุคูููู ุจุฃู ุงููู ุณุจุญุงูู {ููููุณู ููููุซููููู ุดูููุกู ูููููู ุงูุณูููููุนู ุงููุจูุตููุฑู}</p>
         <p>ููุง ููููู ุนูู ูุง ูุตู ุจู ููุณูุ ููุง ูุญุฑููู ุงูููู ุนู ููุงุถุนูุ ููุง ููุญุฏูู ูู ุฃุณูุงุก ุงููู ูุขูุงุชู.</p>
         <p>ููุง ูููููู ููุง ููุซููู ุตูุงุชู ุจุตูุงุช ุฎูููุ ูุฃูู ุณุจุญุงูู ูุง ุณูู ูู ููุง ููุก ูู ููุง ูุฏ ูู.</p>`,
        `<h3>ุฃุณูุงุก ุงููู ูุตูุงุชู - ุงูุตูุญุฉ 3</h3>
         <p>ููุคูููู ุจุฃู ุงููู ุชุนุงูู ููุตูู ุจูุง ูุตู ุจู ููุณูุ ูุจูุง ูุตูู ุจู ุฑุณูููุ ูู ุงูุฃุณูุงุก ุงูุญุณูู ูุงูุตูุงุช ุงูุนูู.</p>
         <p>ููุซุจุชูู ูู ูุง ุฃุซุจุชู ูููุณูุ ูููููู ุนูู ูุง ููุงู ุนู ููุณูุ ูู ุบูุฑ ุชุญุฑูู ููุง ุชุนุทููุ ููู ุบูุฑ ุชูููู ููุง ุชูุซูู.</p>`,
        `<h3>ุงูุฅููุงู ุจุงูููุงุฆูุฉ - ุงูุตูุญุฉ 4</h3>
         <p>ููู ุงูุฅููุงู ุจุงููู: ุงูุฅููุงู ุจููุงุฆูุชูุ ูุฃููู ุนุจุงุฏ ููุฑูููุ ูุง ูุนุตูู ุงููู ูุง ุฃูุฑูู ูููุนููู ูุง ูุคูุฑูู.</p>
         <p>ููุคูููู ุจุฃู ูููู ุฌุจุฑูู ููููุงุฆูู ูุฅุณุฑุงููู ูููู ุงูููุช ูุญููุฉ ุงูุนุฑุด ูุบูุฑูู.</p>`,
        `<h3>ุงูุฅููุงู ุจุงููุชุจ - ุงูุตูุญุฉ 5</h3>
         <p>ููู ุงูุฅููุงู ุจุงููู: ุงูุฅููุงู ุจูุชุจู ุงูููุฒูุฉ ุนูู ุฑุณููุ ูุฃู ุงููุฑุขู ููุงู ุงููู ููุฒู ุบูุฑ ูุฎููู.</p>
         <p>ููู ุจุฏุฃ ูุฅููู ูุนูุฏุ ูุฃูู ุชููู ุจู ุญูููุฉุ ูุฃู ูุฐุง ุงููุฑุขู ุงูุฐู ุฃูุฒูู ุนูู ูุญูุฏ ุตูู ุงููู ุนููู ูุณูู ูู ููุงู ุงููู ุญูููุฉ.</p>`,
        `<h3>ุงูุฅููุงู ุจุงูุฑุณู - ุงูุตูุญุฉ 6</h3>
         <p>ููู ุงูุฅููุงู ุจุงููู: ุงูุฅููุงู ุจุฑุณููุ ูุฃู ุงููู ุฃุฑุณู ุฅูู ุงููุงุณ ุฑุณูุงู ูุจุดุฑูู ูููุฐุฑูู.</p>
         <p>ูุฃู ุฃูููู ููุญ ูุขุฎุฑูู ูุญูุฏ ุตูู ุงููู ุนููู ูุณููุ ูุฃูู ุฎุงุชู ุงููุจููู ูุง ูุจู ุจุนุฏู.</p>`,
        `<h3>ุงูุฅููุงู ุจุงูููู ุงูุขุฎุฑ - ุงูุตูุญุฉ 7</h3>
         <p>ููู ุงูุฅููุงู ุจุงููู: ุงูุฅููุงู ุจุงูููู ุงูุขุฎุฑุ ููู ููู ุงูููุงูุฉ ุงูุฐู ูุจุนุซ ุงููู ููู ุงููุงุณ ููุญุณุงุจ ูุงูุฌุฒุงุก.</p>
         <p>ููุคูููู ุจุงูุจุนุซ ุจุนุฏ ุงูููุชุ ูุจุงูุญุณุงุจ ูุงูููุฒุงูุ ูุงูุตุฑุงุท ูุงูุฌูุฉ ูุงููุงุฑ.</p>`,
        `<h3>ุงูุฅููุงู ุจุงููุฏุฑ - ุงูุตูุญุฉ 8</h3>
         <p>ููู ุงูุฅููุงู ุจุงููู: ุงูุฅููุงู ุจุงููุฏุฑ ุฎูุฑู ูุดุฑูุ ูุฃู ุงููู ุชุนุงูู ุฎุงูู ูู ุดูุก ูููููู.</p>
         <p>ูุฃูู ูุง ุดุงุก ุงููู ูุงู ููุง ูู ูุดุฃ ูู ูููุ ูุฃูู ุนูู ูู ุดูุก ูุฏูุฑ.</p>`,
        `<h3>ุงููุฑุขู ููุงู ุงููู - ุงูุตูุญุฉ 9</h3>
         <p>ููุคูููู ุจุฃู ุงููุฑุขู ููุงู ุงููู ููุฒู ุบูุฑ ูุฎูููุ ููู ุจุฏุฃ ูุฅููู ูุนูุฏ.</p>
         <p>ูุฃู ุงููู ุชููู ุจู ุญูููุฉุ ูุฃู ูุฐุง ุงููุฑุขู ุงูุฐู ุฃูุฒูู ุนูู ูุญูุฏ ูู ููุงู ุงููู ุญูููุฉ ูุง ููุงู ุบูุฑู.</p>`,
        `<h3>ุฑุคูุฉ ุงููู ูู ุงูุขุฎุฑุฉ - ุงูุตูุญุฉ 10</h3>
         <p>ููุคูููู ุจุฃู ุงููุคูููู ูุฑูู ุฑุจูู ููู ุงูููุงูุฉ ุนูุงูุงู ุจุฃุจุตุงุฑููุ ููุง ูุฑูู ุงูุดูุณ ูุงูููุฑ ูููุฉ ุงูุจุฏุฑ.</p>
         <p>ูุงู ุชุนุงูู: {ููุฌูููู ููููููุฆูุฐู ููุงุถูุฑูุฉู * ุฅูููู ุฑูุจููููุง ููุงุธูุฑูุฉู}</p>`,
        `<h3>ูุญุจุฉ ุงูุตุญุงุจุฉ - ุงูุตูุญุฉ 11</h3>
         <p>ููู ุฃุตูู ุฃูู ุงูุณูุฉ ูุงูุฌูุงุนุฉ: ุณูุงูุฉ ูููุจูู ูุฃูุณูุชูู ูุฃุตุญุงุจ ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู.</p>
         <p>ููุญุจูู ุฃูู ุจูุช ุฑุณูู ุงูููุ ููุชููููููุ ููุญูุธูู ูููู ูุตูุฉ ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู.</p>`,
        `<h3>ุงูุฎุงุชูุฉ - ุงูุตูุญุฉ 12</h3>
         <p>ูุฐุง ุงุนุชูุงุฏ ุงููุฑูุฉ ุงููุงุฌูุฉ ุงูููุตูุฑุฉ ุฅูู ููุงู ุงูุณุงุนุฉุ ุฃูู ุงูุณูุฉ ูุงูุฌูุงุนุฉ.</p>
         <p>ููู ุงูุฅููุงู ุจุงููู ูููุงุฆูุชู ููุชุจู ูุฑุณูู ูุงูููู ุงูุขุฎุฑ ูุงููุฏุฑ ุฎูุฑู ูุดุฑู.</p>
         <p>ูุณุฃู ุงููู ุฃู ูุซุจุชูุง ุนูู ูุฐุง ุงูุงุนุชูุงุฏุ ูุฃู ูุญูููุง ุนููู ููููุชูุง ุนููู. ุขููู.</p>`
      ],
      7: [ // Kitab at-Tawhid - 15 pages
        `<h3>ุจุงุจ ูุถู ุงูุชูุญูุฏ - ุงูุตูุญุฉ 1</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ุงูููุฐูููู ุขูููููุง ูููููู ููููุจูุณููุง ุฅููููุงูููููู ุจูุธููููู ุฃููููุฆููู ูููููู ุงููุฃููููู ูููููู ููููุชูุฏูููู}</p>
         <p>ุนู ุนุจุงุฏุฉ ุจู ุงูุตุงูุช ุฑุถู ุงููู ุนูู ูุงู: ูุงู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู: "ูู ุดูุฏ ุฃู ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ููุ ูุฃู ูุญูุฏุงู ุนุจุฏู ูุฑุณูููุ ูุฃู ุนูุณู ุนุจุฏ ุงููู ูุฑุณููู ููููุชู ุฃููุงูุง ุฅูู ูุฑูู ูุฑูุญ ูููุ ูุงูุฌูุฉ ุญูุ ูุงููุงุฑ ุญูุ ุฃุฏุฎูู ุงููู ุงูุฌูุฉ ุนูู ูุง ูุงู ูู ุงูุนูู"</p>`,
        `<h3>ุจุงุจ ูู ุญูู ุงูุชูุญูุฏ - ุงูุตูุญุฉ 2</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ููุนูุฏู ุงูููููู ุงูููุฐูููู ุขูููููุง ูููููููู ููุนููููููุง ุงูุตููุงููุญูุงุชู ููููุณูุชูุฎูููููููููููู ููู ุงููุฃูุฑูุถู}</p>
         <p>ุนู ุฃุจู ูุฑูุฑุฉ ุฑุถู ุงููู ุนูู ูุงู: ูุงู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู: "ุฃุณุนุฏ ุงููุงุณ ุจุดูุงุนุชู ููู ุงูููุงูุฉ ูู ูุงู ูุง ุฅูู ุฅูุง ุงููู ุฎุงูุตุงู ูู ููุจู ุฃู ููุณู"</p>`,
        `<h3>ุจุงุจ ุงูุฎูู ูู ุงูุดุฑู - ุงูุตูุญุฉ 3</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ุฅูููู ุงูููููู ููุง ููุบูููุฑู ุฃููู ููุดูุฑููู ุจููู ููููุบูููุฑู ููุง ุฏูููู ุฐููููู ูููููู ููุดูุงุกู}</p>
         <p>ุนู ุฃุจู ุจูุฑ ุฑุถู ุงููู ุนูู ุฃูู ูุงู: ูุง ุฑุณูู ุงูููุ ุนูููู ุฏุนุงุก ุฃุฏุนู ุจู ูู ุตูุงุชู. ูุงู: "ูู: ุงูููู ุฅูู ุธููุช ููุณู ุธููุงู ูุซูุฑุงูุ ููุง ูุบูุฑ ุงูุฐููุจ ุฅูุง ุฃูุชุ ูุงุบูุฑ ูู ูุบูุฑุฉ ูู ุนูุฏูุ ูุงุฑุญููู ุฅูู ุฃูุช ุงูุบููุฑ ุงูุฑุญูู"</p>`,
        `<h3>ุจุงุจ ุงูุฏุนุงุก ุฅูู ุดูุงุฏุฉ ุฃู ูุง ุฅูู ุฅูุง ุงููู - ุงูุตูุญุฉ 4</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ูููู ููุฐููู ุณูุจููููู ุฃูุฏูุนูู ุฅูููู ุงูููููู ุนูููู ุจูุตููุฑูุฉู ุฃูููุง ูููููู ุงุชููุจูุนูููู}</p>
         <p>ุนู ุงุจู ุนุจุงุณ ุฑุถู ุงููู ุนูููุง: ุฃู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู ููุง ุจุนุซ ูุนุงุฐุงู ุฅูู ุงูููู ูุงู ูู: "ุฅูู ุชุฃุชู ูููุงู ูู ุฃูู ุงููุชุงุจุ ููููู ุฃูู ูุง ุชุฏุนููู ุฅููู ุดูุงุฏุฉ ุฃู ูุง ุฅูู ุฅูุง ุงููู"</p>`,
        `<h3>ุจุงุจ ุชูุณูุฑ ุงูุชูุญูุฏ - ุงูุตูุญุฉ 5</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ุฃููููุฆููู ุงูููุฐูููู ููุฏูุนูููู ููุจูุชูุบูููู ุฅูููู ุฑูุจูููููู ุงููููุณููููุฉู}</p>
         <p>ูุงู ุงุจู ูุณุนูุฏ ุฑุถู ุงููู ุนูู: ูุงู ููุฑ ูู ุงูุฅูุณ ูุนุจุฏูู ููุฑุงู ูู ุงูุฌูุ ูุฃุณูู ุงูุฌููููุ ูุงูุฅูุณ ุงูุฐูู ูุงููุง ูุนุจุฏูููู ูุง ูุดุนุฑููุ ููุฒูุช ูุฐู ุงูุขูุฉ.</p>`,
        `<h3>ุจุงุจ ูู ุงูุดุฑู ูุจุณ ุงูุญููุฉ ูุงูุฎูุท - ุงูุตูุญุฉ 6</h3>
         <p>ุนู ุนูุฑุงู ุจู ุญุตูู ุฑุถู ุงููู ุนูู: ุฃู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู ุฑุฃู ุฑุฌูุงู ูู ูุฏู ุญููุฉ ูู ุตูุฑุ ููุงู: "ูุง ูุฐูุ" ูุงู: ูู ุงููุงููุฉ. ูุงู: "ุงูุฒุนูุง ูุฅููุง ูุง ุชุฒูุฏู ุฅูุง ูููุงูุ ูุฅูู ูู ูุช ููู ุนููู ูุง ุฃููุญุช ุฃุจุฏุงู"</p>`,
        `<h3>ุจุงุจ ูู ุชุจุฑู ุจุดุฌุฑ ุฃู ุญุฌุฑ - ุงูุตูุญุฉ 7</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ุฃูููุฑูุฃูููุชููู ุงููููุงุชู ููุงููุนูุฒููู * ููููููุงุฉู ุงูุซููุงููุซูุฉู ุงููุฃูุฎูุฑูู}</p>
         <p>ุนู ุฃุจู ูุงูุฏ ุงูููุซู ุฑุถู ุงููู ุนูู ูุงู: ุฎุฑุฌูุง ูุน ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู ุฅูู ุญููู ููุญู ุญุฏุซุงุก ุนูุฏ ุจููุฑุ ููููุดุฑููู ุณุฏุฑุฉ ูุนูููู ุนูุฏูุง ููุนูููู ุจูุง ุฃุณูุญุชูู ููุงู ููุง ุฐุงุช ุฃููุงุทุ ููุฑุฑูุง ุจุณุฏุฑุฉ ููููุง: ูุง ุฑุณูู ุงูููุ ุงุฌุนู ููุง ุฐุงุช ุฃููุงุท ููุง ููู ุฐุงุช ุฃููุงุท. ููุงู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู: "ุงููู ุฃูุจุฑ! ุฅููุง ุงูุณููุ ููุชู ูุงูุฐู ููุณู ุจูุฏู ููุง ูุงูุช ุจูู ุฅุณุฑุงุฆูู ูููุณู: {ุงุฌูุนููู ููููุง ุฅูููููุง ููููุง ูููููู ุขููููุฉู} ูุชุฑูุจู ุณูู ูู ูุงู ูุจููู"</p>`,
        `<h3>ุจุงุจ ูุง ุฌุงุก ูู ุงูุฐุจุญ ูุบูุฑ ุงููู - ุงูุตูุญุฉ 8</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ูููู ุฅูููู ุตูููุงุชูู ููููุณูููู ููููุญูููุงูู ููููููุงุชูู ููููููู ุฑูุจูู ุงููุนูุงููููููู * ููุง ุดูุฑูููู ูููู}</p>
         <p>ุนู ุนูู ุฑุถู ุงููู ุนูู ูุงู: ุญุฏุซูู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู ุจุฃุฑุจุน ูููุงุช: "ูุนู ุงููู ูู ุฐุจุญ ูุบูุฑ ุงูููุ ููุนู ุงููู ูู ูุนู ูุงูุฏููุ ููุนู ุงููู ูู ุขูู ูุญุฏุซุงูุ ููุนู ุงููู ูู ุบูุฑ ููุงุฑ ุงูุฃุฑุถ"</p>`,
        `<h3>ุจุงุจ ูุง ูุฐุจุญ ููู ุจููุงู ูุฐุจุญ ููู ูุบูุฑ ุงููู - ุงูุตูุญุฉ 9</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ููุง ุชููููู ููููู ุฃูุจูุฏูุง ููููุณูุฌูุฏู ุฃูุณููุณู ุนูููู ุงูุชููููููู ูููู ุฃูููููู ูููููู ุฃูุญูููู ุฃููู ุชูููููู ููููู}</p>
         <p>ุนู ุซุงุจุช ุจู ุงูุถุญุงู ุฑุถู ุงููู ุนูู ูุงู: ูุฐุฑ ุฑุฌู ุฃู ููุญุฑ ุฅุจูุงู ุจุจูุงูุฉุ ูุณุฃู ุงููุจู ุตูู ุงููู ุนููู ูุณูู ููุงู: "ูู ูุงู ูููุง ูุซู ูู ุฃูุซุงู ุงูุฌุงูููุฉ ูุนุจุฏุ" ูุงููุง: ูุง. ูุงู: "ููู ูุงู ูููุง ุนูุฏ ูู ุฃุนูุงุฏููุ" ูุงููุง: ูุง. ููุงู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู: "ุฃูู ุจูุฐุฑู"</p>`,
        `<h3>ุจุงุจ ูู ุงููุฐุฑ ูู ูุนุตูุฉ ุงููู - ุงูุตูุญุฉ 10</h3>
         <p>ุนู ุนุงุฆุดุฉ ุฑุถู ุงููู ุนููุง ูุงูุช: ูุงู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู: "ูู ูุฐุฑ ุฃู ูุทูุน ุงููู ูููุทุนูุ ููู ูุฐุฑ ุฃู ูุนุตู ุงููู ููุง ูุนุตู"</p>
         <p>ูุนู ุฃุจู ูุฑูุฑุฉ ุฑุถู ุงููู ุนูู ูุงู: ูุงู ุฑุณูู ุงููู ุตูู ุงููู ุนููู ูุณูู: "ูุง ูุฐุฑ ูู ูุนุตูุฉ ุงูููุ ููุง ูููุง ูุง ูููู ุงุจู ุขุฏู"</p>`,
        `<h3>ุจุงุจ ูู ุงูุดุฑู ุฃู ูุณุชุบูุซ ุจุบูุฑ ุงููู - ุงูุตูุญุฉ 11</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ููููุง ุชูุฏูุนู ูููู ุฏูููู ุงูููููู ููุง ููุง ููููููุนููู ููููุง ููุถูุฑูููู ููุฅููู ููุนูููุชู ููุฅูููููู ุฅูุฐูุง ูููู ุงูุธููุงููููููู}</p>
         <p>ููููู ุชุนุงูู: {ูููููู ุฃูุถูููู ููููููู ููุฏูุนูู ูููู ุฏูููู ุงูููููู ูููู ููุง ููุณูุชูุฌููุจู ูููู ุฅูููู ูููููู ุงููููููุงููุฉู}</p>`,
        `<h3>ุจุงุจ ููู ุงููู ุชุนุงูู: ุฃู ููู ุดุฑูุงุก - ุงูุตูุญุฉ 12</h3>
         <p>{ุฃููู ูููููู ุดูุฑูููุงุกู ุดูุฑูุนููุง ูููููู ูููู ุงูุฏููููู ููุง ูููู ููุฃูุฐููู ุจููู ุงูููููู}</p>
         <p>ูุงู ุงุจู ูุซูุฑ: ุฃู: ุงุชุฎุฐูุง ุดุฑูุงุก ููู ูู ุฏูููุ ุดุฑุนูุง ููู ูู ุงูุฏูู ูุง ูู ูุฃุฐู ุจู ุงููู.</p>`,
        `<h3>ุจุงุจ ูู ุฃุทุงุน ุงูุนููุงุก ูุงูุฃูุฑุงุก - ุงูุตูุญุฉ 13</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ุงุชููุฎูุฐููุง ุฃูุญูุจูุงุฑููููู ููุฑูููุจูุงูููููู ุฃูุฑูุจูุงุจูุง ูููู ุฏูููู ุงูููููู}</p>
         <p>ุนู ุนุฏู ุจู ุญุงุชู ุฑุถู ุงููู ุนูู ูุงู: ุณูุนุช ุงููุจู ุตูู ุงููู ุนููู ูุณูู ููุฑุฃ ูุฐู ุงูุขูุฉุ ูููุช: ุฅูุง ูุณูุง ูุนุจุฏูู. ูุงู: "ุฃููุณ ูุญุฑููู ูุง ุฃุญู ุงููู ูุชุญุฑููููุ ููุญููู ูุง ุญุฑู ุงููู ูุชุญููููุ" ููุช: ุจูู. ูุงู: "ูุชูู ุนุจุงุฏุชูู"</p>`,
        `<h3>ุจุงุจ ูู ุฌุญุฏ ุดูุฆุงู ูู ุงูุฃุณูุงุก ูุงูุตูุงุช - ุงูุตูุญุฉ 14</h3>
         <p>ูููู ุงููู ุชุนุงูู: {ูููููู ููููููุฑูููู ุจูุงูุฑููุญููููฐูู}</p>
         <p>ูุงู ุงุจู ุนุจุงุณ ุฑุถู ุงููู ุนูููุง: ููุง ูุฒูุช {ุงูุฑููุญููููฐูู ุนูููู ุงููุนูุฑูุดู ุงุณูุชูููููฐ} ูุงูุช ุงูุฌูููุฉ: ุฅู ุงููู ูู ูู ููุงู. ูุฃูุฒู ุงููู: {ุฃูุฃูููููุชููู ูููู ููู ุงูุณููููุงุกู}</p>`,
        `<h3>ุจุงุจ ููู ุงููู ุชุนุงูู: ูุนุฑููู ูุนูุฉ ุงููู - ุงูุตูุญุฉ 15</h3>
         <p>{ููุนูุฑูููููู ููุนูููุชู ุงูููููู ุซูููู ููููููุฑููููููุง ููุฃูููุซูุฑููููู ุงููููุงููุฑูููู}</p>
         <p>ูุงู ูุฌุงูุฏ: ูู ููู ุงูุฑุฌู: ูุฐุง ูุงูู ูุฑุซุชู ุนู ุขุจุงุฆู.</p>
         <p>ููุงู ุนูู ุจู ุนุจุฏ ุงููู: ูููููู: ูููุง ููุงู ูู ููู ูุฐุง ููุฐุง.</p>
         <p>ุชู ุงููุชุงุจ ุจุญูุฏ ุงููู ูุชูููููุ ูุงูุญูุฏ ููู ุฑุจ ุงูุนุงูููู.</p>`
      ]
    };
    return bookPages[bookId] || [];
  };

  // Generate error page when content cannot be fetched
  const generateErrorPage = (book) => {
    const bookLink = book.link || `https://shamela.ws/book/${book.id}`;
    
    return [`
      <div style="text-align: center; padding: 40px 20px;">
        <h3 style="color: #ef4444;">โ๏ธ ูู ูุชู ุชุญููู ุงููุญุชูู</h3>
        <p><strong>ุงููุคูู:</strong> ${book.author}</p>
        <p><strong>ุงููุฆุฉ:</strong> ${categories.find(c => c.id === book.category)?.name || book.category}</p>
        <br>
        <p style="color: #64748b;">ูู ูุชููู ูู ุชุญููู ูุญุชูู ูุฐุง ุงููุชุงุจ ูู ุงูููุชุจุฉ ุงูุดุงููุฉ.</p>
        <br>
        <div style="background: #fef2f2; padding: 20px; border-radius: 12px; border: 2px solid #ef4444; margin: 20px 0;">
          <h4 style="color: #991b1b; margin-top: 0;">ุงูุญููู ุงูููููุฉ:</h4>
          <ul style="text-align: right; color: #7f1d1d;">
            <li>ุชุฃูุฏ ูู ุชุดุบูู ุงูุฎุงุฏู ุงููููู (Proxy Server)</li>
            <li>ุชุญูู ูู ุงุชุตุงูู ุจุงูุฅูุชุฑูุช</li>
            <li>ุฌุฑุจ ูุชุงุจุงู ุขุฎุฑ</li>
            <li>ุงูุฑุฃ ุงููุชุงุจ ูุจุงุดุฑุฉ ุนูู ูููุน ุงูุดุงููุฉ</li>
          </ul>
        </div>
        <a href="${bookLink}" target="_blank" rel="noopener noreferrer" 
           style="display: inline-block; background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); 
                  color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; 
                  font-weight: 600; margin-top: 10px;">
          ๐ ุงูุชุญ ุงููุชุงุจ ูู ุงูููุชุจุฉ ุงูุดุงููุฉ
        </a>
      </div>
    `];
  };

  const loadBookPage = (book, pageNum) => {
    // Check if book has custom pages first
    const customPages = getBookPages(book.id);
    
    if (customPages.length > 0) {
      // Use custom pages for special books
      setTotalPages(customPages.length);
      setBookContent(`
        <div class="book-header">
          <h1>${book.title}</h1>
          <h2>${book.author}</h2>
        </div>
        <div class="book-body">
          ${customPages[pageNum - 1] || customPages[0]}
        </div>
      `);
    } else {
      // Show error page for books without content
      const errorPages = generateErrorPage(book);
      setTotalPages(1);
      setBookContent(`
        <div class="book-header">
          <h1>${book.title}</h1>
          <h2>${book.author}</h2>
        </div>
        <div class="book-body">
          ${errorPages[0]}
        </div>
      `);
    }
  };

  // Fetch real book content from various APIs
  const fetchBookContent = async (book) => {
    try {
      console.log(`Fetching book ${book.id}...`);
      
      // Map book IDs to hadithapi.com book slugs
      const hadithApiMap = {
        'sahih-bukhari': 'sahih-bukhari',
        'sahih-muslim': 'sahih-muslim',
        'sunan-abu-dawud': 'abu-dawood',
        'jami-tirmidhi': 'al-tirmidhi',
        'sunan-nasai': 'sunan-nasai',
        'sunan-ibn-majah': 'ibn-e-majah',
        'muwatta-malik': 'mishkat',
        'musnad-ahmad': 'musnad-ahmad',
        'sunan-darimi': 'mishkat',
        'riyadh-salihin': 'mishkat',
        '40-hadith-nawawi': 'mishkat',
        'adab-mufrad': 'mishkat',
        'shamail-muhammadiyah': 'mishkat',
        'bulugh-maram': 'mishkat'
      };
      
      // Try hadithapi.com first for hadith books
      if (hadithApiMap[book.id]) {
        console.log('Fetching from hadithapi.com...');
        const bookSlug = hadithApiMap[book.id];
        const apiKey = '$2y$10$vabsTau4KVlqw6cXEe3TEutrDG3mNFzIN227g2fuzUWo8r6hFsOq';
        
        try {
          // Fetch hadiths from the collection (first 50)
          const response = await fetch(`https://hadithapi.com/api/hadiths?apiKey=${apiKey}&book=${bookSlug}&paginate=50`, {
            headers: {
              'Accept': 'application/json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            console.log('โ Got data from hadithapi.com:', data);
            
            if (data.hadiths && data.hadiths.data && data.hadiths.data.length > 0) {
              let allContent = `<div style="padding: 20px;">
                <h2 style="text-align: center; color: #2563eb; margin-bottom: 10px;">${book.title}</h2>
                <h3 style="text-align: center; color: #64748b; margin-bottom: 30px;">${book.author}</h3>
              `;
              
              data.hadiths.data.forEach((hadith, idx) => {
                allContent += `
                  <div style="margin: 30px 0; padding: 25px; background: #f8f9fa; border-radius: 10px; border-right: 4px solid #2563eb;">
                    <h4 style="color: #2563eb; margin-bottom: 15px;">ุงูุญุฏูุซ ${hadith.hadithNumber || idx + 1}</h4>
                    <p style="font-size: 1.2rem; line-height: 2.2; text-align: right; color: #1e293b; direction: rtl;">
                      ${hadith.hadithArabic || hadith.hadithUrdu || hadith.hadithEnglish || ''}
                    </p>
                    ${hadith.hadithEnglish ? `<p style="font-size: 1rem; line-height: 1.8; color: #475569; margin-top: 15px; font-style: italic;">${hadith.hadithEnglish}</p>` : ''}
                    ${hadith.status ? `<p style="font-size: 0.9rem; color: #059669; margin-top: 10px; font-weight: 600;">Status: ${hadith.status}</p>` : ''}
                  </div>
                `;
              });
              
              allContent += `
                <p style="text-align: center; color: #64748b; margin-top: 50px; font-size: 1.1rem;">
                  ${data.hadiths.data.length} ุฃุญุงุฏูุซ ูู ${book.title} - ุงููุตุฏุฑ: hadithapi.com
                </p>
              </div>`;
              
              console.log(`โ Successfully fetched ${data.hadiths.data.length} hadiths!`);
              return { content: allContent, html: allContent };
            }
          }
        } catch (err) {
          console.log('hadithapi.com error:', err.message);
        }
      }
      
      // Check if we have embedded content as fallback
      if (booksContent[book.id]) {
        console.log('Using embedded content for', book.id);
        return { content: booksContent[book.id], html: booksContent[book.id] };
      }
      
      // Handle Quran
      if (book.id === 'quran') {
        console.log('Fetching Quran from Quran.com API...');
        let allContent = '<div style="text-align: center; padding: 20px;"><h2>ุงููุฑุขู ุงููุฑูู</h2></div>';
        
        // Fetch first 10 surahs as example (you can increase this)
        for (let surah = 1; surah <= 10; surah++) {
          try {
            const response = await fetch(`https://api.quran.com/api/v4/quran/verses/uthmani?chapter_number=${surah}`);
            const data = await response.json();
            
            if (data.verses) {
              allContent += `<div style="margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">`;
              allContent += `<h3 style="color: #2563eb; text-align: center;">ุณูุฑุฉ ${surah}</h3>`;
              
              data.verses.forEach(verse => {
                allContent += `<p style="font-size: 1.3rem; line-height: 2.5; text-align: right; margin: 15px 0;">${verse.text_uthmani} <span style="color: #059669;">๏ดฟ${verse.verse_number}๏ดพ</span></p>`;
              });
              
              allContent += `</div>`;
            }
          } catch (err) {
            console.log(`Error fetching surah ${surah}`);
          }
        }
        
        return { content: allContent, html: allContent };
      }
      
      // Handle Hadith books
      if (book.id === 'sahih-bukhari' || book.id === 'sahih-muslim' || book.id === 'riyadh-salihin') {
        console.log('Fetching Hadith from Sunnah.com API...');
        const bookSlug = book.id === 'sahih-bukhari' ? 'bukhari' : 
                        book.id === 'sahih-muslim' ? 'muslim' : 'riyadussalihin';
        
        let allContent = `<div style="text-align: center; padding: 20px;"><h2>${book.title}</h2><h3>${book.author}</h3></div>`;
        
        try {
          const response = await fetch(`https://api.sunnah.com/v1/collections/${bookSlug}/books`, {
            headers: {
              'X-API-Key': '$2y$10$DqkEKxCnGwxZRRqXlMhQeOYCvC4qKFNKZHVKe9Vr8Vl0Vl0Vl0Vl0'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            
            if (data.data && data.data.length > 0) {
              // Get first book
              const firstBook = data.data[0];
              const hadithResponse = await fetch(`https://api.sunnah.com/v1/collections/${bookSlug}/books/${firstBook.bookNumber}/hadiths`, {
                headers: {
                  'X-API-Key': '$2y$10$DqkEKxCnGwxZRRqXlMhQeOYCvC4qKFNKZHVKe9Vr8Vl0Vl0Vl0Vl0'
                }
              });
              
              if (hadithResponse.ok) {
                const hadithData = await hadithResponse.json();
                
                if (hadithData.data) {
                  hadithData.data.slice(0, 20).forEach((hadith, idx) => {
                    allContent += `<div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">`;
                    allContent += `<h4 style="color: #2563eb;">ุญุฏูุซ ${idx + 1}</h4>`;
                    allContent += `<p style="font-size: 1.1rem; line-height: 2; text-align: right;">${hadith.hadithArabic || hadith.body}</p>`;
                    allContent += `</div>`;
                  });
                }
              }
            }
          }
        } catch (err) {
          console.log('Sunnah.com API error:', err);
        }
        
        return { content: allContent, html: allContent };
      }
      
      // For other books, try the proxy server
      const apiUrl = process.env.NODE_ENV === 'production'
        ? 'https://tawhid-app-backend.onrender.com'
        : window.location.hostname === 'localhost'
          ? 'http://localhost:3001'
          : `http://${window.location.hostname}:3001`;
      const response = await fetch(`${apiUrl}/api/book/${book.id}`);
      
      if (response.ok) {
        const data = await response.json();
        
        if (data.success && data.content) {
          console.log(`โ Successfully fetched book content!`);
          return {
            content: data.content,
            html: data.content
          };
        }
      }
      
    } catch (error) {
      console.error('Error fetching book:', error.message);
    }
    return null;
  };

  const handleBookClick = async (book) => {
    setSelectedBook(book);
    setCurrentPage(1);
    setLoading(true);
    
    console.log('=== LOADING BOOK ===');
    console.log('Book ID:', book.id);
    console.log('Book Title:', book.title);
    console.log('Book Link:', book.link);
    
    try {
      // Try to fetch real content from Shamela
      console.log('Attempting to fetch content from proxy server...');
      const shamelaContent = await fetchBookContent(book);
      
      if (shamelaContent && (shamelaContent.content || shamelaContent.html)) {
        console.log('โ SUCCESS! Book content fetched!');
        console.log('Content length:', shamelaContent.content?.length || shamelaContent.html?.length);
        
        // Use HTML if available, otherwise use text
        const contentToUse = shamelaContent.html || shamelaContent.content || '';
        
        // For Quran and Hadith, the content is already formatted with divs
        // Just display it all with scrolling
        if (book.id === 'quran' || book.id === 'sahih-bukhari' || book.id === 'sahih-muslim' || book.id === 'riyadh-salihin') {
          setTotalPages(1); // All content in one scrollable page
          setBookContent(`
            <div class="book-header">
              <h1>${book.title}</h1>
              <h2>${book.author}</h2>
              <p style="color: #10b981; font-size: 0.9rem;">โ ูุญุชูู ูู ${book.id === 'quran' ? 'Quran.com' : 'Sunnah.com'}</p>
            </div>
            <div class="book-body" style="max-height: 600px; overflow-y: auto;">
              ${contentToUse}
            </div>
          `);
        } else {
          // For other books, split into pages
          const charsPerPage = 3000;
          const numPages = Math.ceil(contentToUse.length / charsPerPage);
          
          console.log('Split into', numPages, 'pages');
          
          setTotalPages(Math.max(numPages, 1));
          
          // Create pages from content
          const pages = [];
          for (let i = 0; i < numPages; i++) {
            const startIdx = i * charsPerPage;
            const endIdx = Math.min((i + 1) * charsPerPage, contentToUse.length);
            const pageContent = contentToUse.substring(startIdx, endIdx);
            pages.push(pageContent);
          }
          
          setBookContent(`
            <div class="book-header">
              <h1>${book.title}</h1>
              <h2>${book.author}</h2>
              <p style="color: #10b981; font-size: 0.9rem;">โ ุตูุญุฉ 1 ูู ${numPages}</p>
            </div>
            <div class="book-body">
              ${pages[0]}
            </div>
          `);
          
          // Store pages for navigation
          book.contentPages = pages;
        }
        
        book.hasRealContent = true;
      } else {
        console.log('โ No content returned from proxy');
        console.log('Showing error page');
        // Show error page
        loadBookPage(book, 1);
      }
    } catch (error) {
      console.error('โ ERROR loading book:', error);
      // Show error page
      loadBookPage(book, 1);
    }
    
    setLoading(false);
    console.log('=== LOADING COMPLETE ===');
  };

  return (
    <div className="books-modal-overlay" onClick={onClose}>
      <div className="books-modal" onClick={(e) => e.stopPropagation()}>
        <div className="books-header">
          <div className="books-title">
            <BookOpen size={24} />
            <h2>ุงูููุชุจุฉ ุงูุฅุณูุงููุฉ</h2>
          </div>
          <button className="close-button" onClick={onClose}>
            <X size={24} />
          </button>
        </div>

        {!selectedBook ? (
          <div className="books-content">
            {/* Search Bar */}
            <div className="books-search">
              <Search size={18} className="search-icon" />
              <input
                type="text"
                placeholder="ุงุจุญุซ ุนู ูุชุงุจ ุฃู ูุคูู..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="books-search-input"
              />
            </div>

            {/* Categories */}
            <div className="books-categories">
              {categories.map(category => (
                <button
                  key={category.id}
                  className={`category-btn ${selectedCategory === category.id ? 'active' : ''}`}
                  onClick={() => setSelectedCategory(category.id)}
                >
                  {category.name}
                </button>
              ))}
            </div>

            {/* Books List */}
            <div className="books-list">
              {loadingBooks ? (
                <div className="books-loading">
                  <Loader2 className="loading-spinner" size={48} />
                  <p>ุฌุงุฑู ุชุญููู ุงููุชุจ...</p>
                  <p>Loading books...</p>
                </div>
              ) : filteredBooks.length === 0 ? (
                <div className="no-results">
                  <BookOpen size={48} />
                  <p>ูุง ุชูุฌุฏ ูุชุจ ูุทุงุจูุฉ ููุจุญุซ</p>
                </div>
              ) : (
                filteredBooks.map(book => (
                  <div
                    key={book.id}
                    className="book-card"
                    onClick={() => handleBookClick(book)}
                  >
                    <div className="book-info">
                      <h3>{book.title}</h3>
                      <p className="book-author">{book.author}</p>
                      <p className="book-description">{book.description}</p>
                    </div>
                    <ChevronRight size={20} className="book-arrow" />
                  </div>
                ))
              )}
            </div>
          </div>
        ) : (
          <div className="book-reader">
            <button 
              className="back-button"
              onClick={() => {
                setSelectedBook(null);
                setBookContent('');
                setCurrentPage(1);
              }}
            >
              โ ุงูุนูุฏุฉ ููููุชุจุฉ
            </button>

            {loading ? (
              <div className="book-loading">
                <Loader2 className="loading-spinner" size={48} />
                <p>ุฌุงุฑู ุชุญููู ุงููุชุงุจ ุงููุงูู ูู ูุงุนุฏุฉ ุจูุงูุงุช ุงูููุชุจุฉ ุงูุดุงููุฉ...</p>
                <p style={{ fontSize: '0.9rem', color: '#64748b', marginTop: '10px' }}>
                  ูุชู ุชูุฒูู ุฌููุน ุตูุญุงุช ุงููุชุงุจ... ูุฏ ูุณุชุบุฑู 10-30 ุซุงููุฉ
                </p>
                <p style={{ fontSize: '0.85rem', color: '#9ca3af', marginTop: '5px' }}>
                  Downloading complete book with ALL pages from Shamela database...
                </p>
                <p style={{ fontSize: '0.8rem', color: '#10b981', marginTop: '10px' }}>
                  โ ุจุนุฏ ุงูุชุญูููุ ุณูุชู ุญูุธ ุงููุชุงุจ ูููุตูู ุงูุณุฑูุน
                </p>
              </div>
            ) : (
              <>
                <div 
                  className="book-content"
                  dangerouslySetInnerHTML={{ __html: bookContent }}
                />
                
                {/* Pagination Controls */}
                {totalPages > 1 && (
                  <div className="pagination-controls">
                    <button
                      className="page-button"
                      onClick={() => {
                        if (currentPage > 1) {
                          const newPage = currentPage - 1;
                          setCurrentPage(newPage);
                          
                          // Check if book has real content pages
                          if (selectedBook.contentPages && selectedBook.contentPages[newPage - 1]) {
                            setBookContent(`
                              <div class="book-header">
                                <h1>${selectedBook.title}</h1>
                                <h2>${selectedBook.author}</h2>
                              </div>
                              <div class="book-body">
                                <p>${selectedBook.contentPages[newPage - 1]}</p>
                              </div>
                            `);
                          } else {
                            loadBookPage(selectedBook, newPage);
                          }
                        }
                      }}
                      disabled={currentPage === 1}
                    >
                      โ ุงูุตูุญุฉ ุงูุณุงุจูุฉ
                    </button>
                    
                    <span className="page-info">
                      ุตูุญุฉ {currentPage} ูู {totalPages}
                    </span>
                    
                    <button
                      className="page-button"
                      onClick={() => {
                        if (currentPage < totalPages) {
                          const newPage = currentPage + 1;
                          setCurrentPage(newPage);
                          
                          // Check if book has real content pages
                          if (selectedBook.contentPages && selectedBook.contentPages[newPage - 1]) {
                            setBookContent(`
                              <div class="book-header">
                                <h1>${selectedBook.title}</h1>
                                <h2>${selectedBook.author}</h2>
                              </div>
                              <div class="book-body">
                                <p>${selectedBook.contentPages[newPage - 1]}</p>
                              </div>
                            `);
                          } else {
                            loadBookPage(selectedBook, newPage);
                          }
                        }
                      }}
                      disabled={currentPage === totalPages}
                    >
                      ุงูุตูุญุฉ ุงูุชุงููุฉ โ
                    </button>
                  </div>
                )}
              </>
            )}
          </div>
        )}
      </div>
    </div>
  );
}

export default Books;
